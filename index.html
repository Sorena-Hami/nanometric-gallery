<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ژورنال نانومتریک | NanoMetric Gallery</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body data-theme="dark">

    <!-- صدای ورق زدن -->
    <audio id="flip-sound" src="https://www.soundjay.com/books/sounds/page-flip-01a.mp3"></audio>

    <!-- لودینگ هوشمند -->
    <div id="loader-overlay">
        <div class="spinner"></div>
        <p id="loader-text">در حال اتصال به گالری...</p>
        <button id="retry-btn" onclick="location.reload()" style="display:none; margin-top:20px; padding:10px 20px; background:red; color:white; border:none; border-radius:10px;">تلاش مجدد</button>
    </div>

    <!-- هدر -->
    <header class="main-header">
        <div class="header-top">
            <img src="https://res.cloudinary.com/dsj7o7yld/image/upload/v1767110113/558dc96a-eef1-4f98-bcec-a83999e8b9d0_1_esp524.png" class="logo">
            <div class="header-actions">
                <a href="tel:09304653535" class="header-call"><i class="fas fa-phone"></i></a>
                <div class="theme-switch-wrapper">
                    <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
                    <label for="theme-toggle" class="theme-btn">
                        <i class="fas fa-moon"></i>
                        <i class="fas fa-sun"></i>
                    </label>
                </div>
            </div>
        </div>

        <!-- اسلایدر -->
        <div class="swiper mySwiper">
            <div class="swiper-wrapper" id="slider-wrapper">
                <!-- پر شدن خودکار -->
            </div>
            <div class="swiper-pagination"></div>
        </div>
    </header>

    <!-- ابزارها (چسبنده) -->
    <div class="sticky-tools">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="جستجو (کد، نام، دسته)...">
            <div class="view-icons">
                <button class="v-btn active" onclick="setView('grid')"><i class="fas fa-border-all"></i></button>
                <button class="v-btn" onclick="setView('book')"><i class="fas fa-book-open"></i></button>
            </div>
        </div>
        <div class="tags-scroll" id="tags-container"></div>
    </div>

    <main>
        <!-- نمای گرید -->
        <div id="grid-view" class="gallery-container"></div>

        <!-- نمای کتاب (CSS 3D) -->
        <div id="book-view">
            <div class="book-stage">
                <div class="book-cover" id="book-pages">
                    <!-- صفحات اینجا ساخته می‌شوند -->
                </div>
            </div>
            <div class="book-controls">
                <button onclick="prevPage()">❮ قبلی</button>
                <span id="page-num">جلد</span>
                <button onclick="nextPage()">بعدی ❯</button>
            </div>
        </div>
    </main>

    <!-- سبد خرید -->
    <div class="float-cart" onclick="toggleCartPanel()">
        <i class="fas fa-shopping-bag"></i>
        <span id="cart-badge">0</span>
    </div>

    <!-- پنل سبد -->
    <div class="cart-drawer" id="cart-drawer">
        <div class="cart-head">
            <h3>سبد سفارش</h3>
            <button onclick="toggleCartPanel()">✕</button>
        </div>
        <div class="cart-body" id="cart-list">
            <p style="text-align:center; color:#777; margin-top:50px;">سبد خالی است</p>
        </div>
        <div class="cart-foot">
            <div id="cart-total">جمع: 0 تومان</div>
            <div class="social-mini-row" id="cart-socials"></div>
        </div>
    </div>

    <!-- مودال جزئیات -->
    <div class="modal" id="modal">
        <div class="modal-box">
            <button class="modal-close" onclick="closeM
